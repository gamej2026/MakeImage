<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generator - Azure OpenAI</title>
    <link rel="stylesheet" href="styles.css">
    <script src="config.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="usage-display">
                <div class="usage-card">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="3" width="18" height="18" rx="3" stroke="currentColor" stroke-width="2"/>
                        <circle cx="8.5" cy="8.5" r="2" fill="currentColor"/>
                        <path d="M3 15L8 10L12 14L17 9L21 13V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V15Z" fill="currentColor" opacity="0.5"/>
                    </svg>
                    <span class="usage-count" id="totalUsageCount">0</span>
                    <span class="usage-unit">images</span>
                </div>
            </div>
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="40" height="40" rx="12" fill="url(#gradient)"/>
                    <path d="M20 10L28 16V24L20 30L12 24V16L20 10Z" fill="white"/>
                    <defs>
                        <linearGradient id="gradient" x1="0" y1="0" x2="40" y2="40">
                            <stop offset="0%" stop-color="#667eea"/>
                            <stop offset="100%" stop-color="#764ba2"/>
                        </linearGradient>
                    </defs>
                </svg>
                <h1>AI Image Generator</h1>
            </div>
            <p class="subtitle">Powered by Azure OpenAI GPT Image 1.5</p>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Configuration Panel -->
            <div class="config-panel">
                <h2 class="section-title">Configuration</h2>
                
                <!-- API Settings -->
                <div class="config-section">
                    <h3 class="config-subtitle">API Settings</h3>
                    <!-- API Endpoint, API Key, and Deployment Name are configured via GitHub Secrets -->
                    <!-- Hidden inputs to store the values -->
                    <input type="hidden" id="apiEndpoint">
                    <input type="hidden" id="apiKey">
                    <input type="hidden" id="deploymentName" value="gpt-image-1.5">
                    <input type="hidden" id="apiVersion" value="2025-04-01-preview">
                </div>

                <!-- Image Generation Parameters -->
                <div class="config-section">
                    <h3 class="config-subtitle">Image Parameters</h3>
                    
                    <div class="form-group">
                        <label for="generationMode">Generation Mode</label>
                        <select id="generationMode">
                            <option value="text-only">Text to Image</option>
                            <option value="image-with-text">Image + Text (Reference Image)</option>
                            <option value="image-edit">Image Editing (Inpainting)</option>
                        </select>
                        <span class="helper-text">Choose generation mode</span>
                    </div>

                    <div class="form-group" id="imageUploadGroup" style="display: none;">
                        <label for="referenceImage" id="imageUploadLabel">Reference Image</label>
                        <div class="image-upload-container">
                            <input type="file" id="referenceImage" accept="image/*" style="display: none;">
                            <button type="button" id="uploadImageBtn" class="btn-upload">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M10 14V6M10 6L6 10M10 6L14 10" stroke="currentColor" stroke-width="2"/>
                                    <path d="M3 14V16C3 17.1 3.9 18 5 18H15C16.1 18 17 17.1 17 16V14" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Upload Image
                            </button>
                            <div id="imagePreview" class="image-preview" style="display: none;">
                                <img id="previewImg" src="" alt="Preview">
                                <button type="button" id="removeImageBtn" class="btn-remove">×</button>
                            </div>
                        </div>
                        <span class="helper-text" id="imageUploadHelperText">Upload a reference image for visual context (not directly processed by API)</span>
                    </div>

                    <!-- Mask Editor for Image Editing Mode -->
                    <div class="form-group" id="maskEditorGroup" style="display: none;">
                        <label for="maskEditor">Mask Editor</label>
                        <div class="mask-editor-container">
                            <div class="mask-editor-toolbar">
                                <button type="button" id="brushModeBtn" class="tool-btn active">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <circle cx="6" cy="14" r="4" stroke="currentColor" stroke-width="2"/>
                                        <path d="M9 11L16 4L18 6L11 13" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    Brush
                                </button>
                                <button type="button" id="eraseModeBtn" class="tool-btn">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M12 3L17 8L9 16L4 16L4 11L12 3Z" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    Eraser
                                </button>
                                <div class="brush-size-control">
                                    <label for="brushSize">Size:</label>
                                    <input type="range" id="brushSize" min="5" max="50" value="20">
                                    <span id="brushSizeValue">20</span>
                                </div>
                                <button type="button" id="clearMaskBtn" class="tool-btn">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M4 4L16 16M16 4L4 16" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    Clear
                                </button>
                            </div>
                            <div class="canvas-container">
                                <canvas id="maskCanvas"></canvas>
                            </div>
                        </div>
                        <span class="helper-text">Draw on the areas you want to edit/replace (masked areas will be regenerated)</span>
                    </div>

                    <div class="form-group">
                        <label for="prompt">Prompt</label>
                        <textarea id="prompt" rows="4" placeholder="Describe the image you want to generate..."></textarea>
                        <span class="helper-text" id="promptHelperText">Detailed description of the image</span>
                        <div class="info-note" id="infoNote" style="margin-top: 0.5rem; padding: 0.75rem; background: rgba(79, 172, 254, 0.1); border: 1px solid rgba(79, 172, 254, 0.3); border-radius: 8px; font-size: 0.85rem; color: #4facfe; display: none;">
                            <strong>Note:</strong> Azure DALL-E 3 does not support direct image input. The reference image helps you visualize what you want and craft a better prompt.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="size">Image Size</label>
                        <select id="size">
                            <option value="1024x1024">1024x1024 (Square)</option>
                            <option value="1792x1024">1792x1024 (Landscape)</option>
                            <option value="1024x1792">1024x1792 (Portrait)</option>
                        </select>
                        <span class="helper-text">Dimensions of the generated image</span>
                    </div>

                    <div class="form-group">
                        <label for="quality">Quality</label>
                        <select id="quality">
                            <option value="auto" selected>Auto</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                        <span class="helper-text">Image quality level</span>
                    </div>

                    <div class="form-group">
                        <label for="style">Style</label>
                        <select id="style">
                            <option value="vivid">Vivid (Hyper-real and dramatic)</option>
                            <option value="natural">Natural (More natural, less hyper-real)</option>
                            <option value="artistic">Artistic (Painterly and creative)</option>
                            <option value="photorealistic">Photorealistic (Like a photograph)</option>
                            <option value="cinematic">Cinematic (Movie-like quality)</option>
                            <option value="anime">Anime (Japanese animation style)</option>
                            <option value="watercolor">Watercolor (Soft watercolor painting)</option>
                            <option value="oil-painting">Oil Painting (Classic oil painting)</option>
                            <option value="sketch">Sketch (Hand-drawn sketch)</option>
                            <option value="3d-render">3D Render (3D computer graphics)</option>
                            <option value="2d-game-dot-background">2D Game Dot Background (Pixel art background)</option>
                            <option value="2d-game-dot-character">2D Game Dot Character (Pixel art character)</option>
                            <option value="game-illustration">Game Illustration (Video game concept art)</option>
                            <option value="casual-game-illustration">Casual Game Illustration (Bright and friendly)</option>
                            <option value="rpg-game-art">RPG Game Art (Fantasy role-playing style)</option>
                            <option value="mobile-game-ui">Mobile Game UI (Interface and icon design)</option>
                            <option value="retro-game-style">Retro Game Style (8-bit or 16-bit classic)</option>
                            <option value="3d-game-model">3D Game Model (Textured 3D game asset)</option>
                            <option value="game-character-portrait">Game Character Portrait (Character close-up)</option>
                            <option value="game-environment-concept">Game Environment Concept (Level design art)</option>
                            <option value="custom">Custom (Enter your own style)</option>
                        </select>
                        <span class="helper-text">Visual style of the generated image</span>
                    </div>

                    <div class="form-group" id="customStyleGroup" style="display: none;">
                        <label for="customStyle">Custom Style Description</label>
                        <input type="text" id="customStyle" placeholder="Enter your custom style description...">
                        <span class="helper-text">Describe the style you want (e.g., "vintage comic book", "neon cyberpunk")</span>
                    </div>

                    <div class="form-group">
                        <label for="numImages">Number of Images</label>
                        <input type="number" id="numImages" min="1" max="10" value="1">
                        <span class="helper-text">Number of images to generate (1-10)</span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button id="generateBtn" class="btn btn-primary">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 2L2 8L10 14L18 8L10 2Z" fill="currentColor"/>
                            <path d="M2 12L10 18L18 12" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Generate Image
                    </button>
                    <button id="saveConfigBtn" class="btn btn-secondary">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M15 2H5C3.9 2 3 2.9 3 4V16C3 17.1 3.9 18 5 18H15C16.1 18 17 17.1 17 16V4C17 2.9 16.1 2 15 2Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M7 2V6H13V2" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Save Config
                    </button>
                    <button id="loadConfigBtn" class="btn btn-secondary">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 2V10M10 10L6 6M10 10L14 6" stroke="currentColor" stroke-width="2"/>
                            <path d="M3 14V16C3 17.1 3.9 18 5 18H15C16.1 18 17 17.1 17 16V14" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Load Config
                    </button>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="results-panel">
                <h2 class="section-title">Generated Images</h2>
                
                <!-- Status Messages -->
                <div id="statusMessage" class="status-message"></div>
                
                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="loading-spinner" style="display: none;">
                    <div class="spinner"></div>
                    <p>Generating your images...</p>
                    <p class="loading-subtext">This may take a few moments</p>
                </div>

                <!-- Images Gallery -->
                <div id="imageGallery" class="image-gallery"></div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2026 AI Image Generator. Powered by Azure OpenAI.</p>
            <p class="footer-links">
                <a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/dall-e-quickstart" target="_blank">Documentation</a>
                <span>•</span>
                <a href="https://github.com/gamej2026/MakeImage" target="_blank">GitHub</a>
            </p>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>
